<!DOCTYPE html>
<html>
<head>
	<title>TigerGrowl</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link href='http://fonts.googleapis.com/css?family=Patrick+Hand+SC' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Raleway:400,200' rel='stylesheet' type='text/css'>		

	{% if message != "success" %}
	<link href="../static/css/customstyle.css" rel="stylesheet" media="screen">
	<link href="../static/css/nivo-lightbox.css" rel="stylesheet" media="screen">
	<link href="../static/nivo/themes/default/default.css" rel="stylesheet" media="screen">
	<link rel="shortcut icon" href="../static/img/favicon.ico" />
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="../static/js/jquery-1.11.0.min.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="../static/js/bootstrap.min.js"></script>
	<script src="../static/js/fb.js"></script>
	<script src="../static/js/nivo-lightbox.min.js"></script>
	{% else %}
	<link href="../../static/css/customstyle.css" rel="stylesheet" media="screen">
	<link href="../../static/css/nivo-lightbox.css" rel="stylesheet" media="screen">
	<link href="../../static/nivo/themes/default/default.css" rel="stylesheet" media="screen">
	<link rel="shortcut icon" href="../../static/img/favicon.ico" />
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="../../static/js/jquery-1.11.0.min.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="../../static/js/bootstrap.min.js"></script>
	<script src="../../static/js/fb.js"></script>
	<script src="../../static/js/nivo-lightbox.min.js"></script>
	{% endif %}
	

	{% if message != "success" %}
	<script>
		function openpopup2() {
			window.open('../invite','1397500628517','width=400,height=700,toolbar=0,menubar=0,location=0,status=1,scrollbars=1,resizable=1,left=0,top=0');
			return false;
		}
	</script>
	{% else %}
	<script>
		function openpopup2() {
			window.open('../../invite','1397500628517','width=400,height=700,toolbar=0,menubar=0,location=0,status=1,scrollbars=1,resizable=1,left=0,top=0');
			return false;
		}
	</script>
	{% endif %}

	

	<script>
		$(document).ready(function () {
			$('#HostButton').nivoLightbox({
	            effect: 'fall'
	        });
			$('#helpLink').nivoLightbox({
	            effect: 'fall'
	        });
		});
	</script>

</head>
<body>

	{% if message != "success" %}
	<style>
		body {background-image:url('../static/img/arch.jpg');}
	</style>
	{% else %}
	<style>
		body {background-image:url('../../static/img/arch.jpg');}
	</style>
	{% endif %}

	<style>
		.navbar-fixed-top .help img {
			height:50px;
			width: 50px;
			color:white;
			margin-left:-15px;
			margin-right:-15px;
			padding:0px;
		}
	</style>


	<nav class="navbar-wrapper navbar-inverse navbar-fixed-top" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<a class="navbar-brand logo" style="color:white;" href="/feed">TigerGrowl</a>

		<a id="homelink" href="/feed"><button type="button" class="btn btn-default navbar-btn active" style="float: right;margin-right: 45px;margin-left: 45px;"><span class="glyphicon glyphicon-user"></span> My Feed</button></a>

		<img id="FacebookPhoto" href="#" style="height: 50px;padding: 4px; float:right;">

		<a href="/welcome" id="helpLink">
			<div class="help" style="float:right;color:white;margin-right:15px;">
				{% if message != "success" %}
					<img src="../static/img/fork-white.png">
					<img src="../static/img/dish-white.png">
					<img src="../static/img/knife-white.png">
				{% else %}
					<img src="../../static/img/fork-white.png">
					<img src="../../static/img/dish-white.png">
					<img src="../../static/img/knife-white.png">
				{% endif %}
				Help 
			</div>
		</a>
		<!-- /.navbar-collapse -->
	</nav>

	<div class="container-fluid">
		<div class="jumbotron">
			<!-- <a onclick="openpopup()"> -->
			<button type="button" id="HostButton" href="/registermeal" class="btn btn-default btn-lg">
				Host a Meal
			</button>
			<!-- </a> -->
		</div>
	</div>

	<style>
		h1 {
			background-color: rgba(27, 27, 27, 0.9);
			border-radius: 25px;
			border: outset;
			padding: 13px 0px 13px 0px;
		}
	</style>

	<!-- Main feed container -->
	<div class="container" style="height:100%;">
		<h1 data-toggle="collapse" data-target=".host-column"><span class="servicedrop1 glyphicon glyphicon-chevron-down"></span> Meals You are Hosting</h1>
		<div class="feed-column host-column">
			<!-- Hosted Meals Go Here-->
		</div>

		<h1 data-toggle="collapse" data-target=".invite-column"><span class="servicedrop2 glyphicon glyphicon-chevron-down"></span> Invites</h1>
		<div class="feed-column invite-column">
			<!-- Invite Meals Go Here-->
		</div>

		<h1 data-toggle="collapse" data-target=".guest-column"><span class="servicedrop3 glyphicon glyphicon-chevron-down"></span> Meals with You as Guest</h1>
		<div class="feed-column guest-column" style="margin-bottom:100px;">
				<!-- Guest Meals Go Here -->
		</div>
	</div>

	<!-- Glyphicon switches -->
	<script>
		$('.host-column').on('shown.bs.collapse', function() {
			$(".servicedrop1").addClass('glyphicon-chevron-down').removeClass('glyphicon-chevron-up');
		});

		$('.host-column').on('hidden.bs.collapse', function() {
		    $(".servicedrop1").addClass('glyphicon-chevron-up').removeClass('glyphicon-chevron-down');
		});

		$('.invite-column').on('shown.bs.collapse', function() {
			$(".servicedrop2").addClass('glyphicon-chevron-down').removeClass('glyphicon-chevron-up');
		});

		$('.invite-column').on('hidden.bs.collapse', function() {
		    $(".servicedrop2").addClass('glyphicon-chevron-up').removeClass('glyphicon-chevron-down');
		});

		$('.guest-column').on('shown.bs.collapse', function() {
			$(".servicedrop3").addClass('glyphicon-chevron-down').removeClass('glyphicon-chevron-up');
		});

		$('.guest-column').on('hidden.bs.collapse', function() {
		    $(".servicedrop3").addClass('glyphicon-chevron-up').removeClass('glyphicon-chevron-down');
		});
	</script>

	<script>

		var objHost = jQuery.parseJSON( {{myhosts|tojson|safe}} );
		var objInvite = [];
		var objGuest = jQuery.parseJSON( {{myguests|tojson|safe}} );
		var hostnameList = jQuery.parseJSON( {{hostnameList|tojson|safe}} );

		var hostrowDiv = "<div class='row host-row'> \
		<div class='setting-identifier'> </div> \
		<a class='invitebutton' href='#'><button class='btn btn-primary btn-large' style='margin-right:20%; float:right; margin-top: 30px;'><span class='glyphicon glyphicon-exclamation-sign'></span> Invite Friends</button> </a> \
		<div class='attendees'>Who's Coming?</div> \
		</div>";

		var inviterowDiv = "<div class='row feed-row'> \
		<div class='name-identifier'> </div> \
		<div class='setting-identifier'> </div> \
		<div class='attendees'>Who's Coming?</div> \
		<a class='removebutton' href='#'><button class='btn btn-default btn-lg' style='font-family:Arial;font-weight:100;font-size:medium;margin-left:20px;margin-top:10px;'> Leave the Meal </button></a> \
		</div>";

		var guestrowDiv = "<div class='row feed-row'> \
		<div class='name-identifier'> </div> \
		<div class='setting-identifier'> </div> \
		<div class='attendees'>Who's Coming?</div> \
		<div class='buttondiv' style='width: 50%; float: right;padding-right:15%;'> \
		<a class='removebutton' href='../remove/467244/1362325282'><button class='btn btn-default btn-lg' style='font-family:Arial;font-weight:100;font-size:medium;margin-right: 20px;margin-top:10px;float: right;'> Leave the Meal </button></a> \
		</div> \
		</div>";

		

		// self populate the Host divs
		if (objHost == 0) {
			$(".host-column").append("<div class='row feed-row'> \
				<h5 style='color:white;text-align:center;'>You aren't hosting any meals at the moment.</h5> \
			</div>");
		}
		$.each(objHost, function() {
			$(".host-column").append(hostrowDiv);
		});

		// self populate the Invite divs
		if (objInvite.length == 0) {
			$(".invite-column").append("<div class='row feed-row'> \
				<h5 style='color:white;text-align:center;'>You don't have any direct meal invitations at the moment.</h5> \
			</div>");
		}
		else {
			$.each(objInvite, function() {
				$(".invite-column").append(inviterowDiv);
			});
		}

		// self populate the Guest divs
		if (objGuest.length == 0) {
			$(".guest-column").append("<div class='row feed-row'> \
				<h5 style='color:white;text-align:center;'>You didn't join any meals yet.</h5> \
			</div>");
		}
		else {
			$.each(objGuest, function() {
				$(".guest-column").append(guestrowDiv);
			});
		}

		// Hosted meal: place, date, time				
		$(document).ready(function() {
			$(".host-row .setting-identifier").each(function(i) {
				if (objHost[i] !== undefined) { 
					$(this).text(objHost[i][1] + ", " + objHost[i][2] + ", " + objHost[i++][3]);
				}
			});
		});
		
		// Guest meals: who?
		$(document).ready(function() {
			$(".guest-column .feed-row .name-identifier").each(function(i) {
				if (objGuest[i] !== undefined ) {
					$(this).text(hostnameList[i][1] + ' ' + hostnameList[i++][2] + "'s Meal");
				}
			});
		});

		// Guest meals: setting
		$(document).ready(function() {
			$(".guest-column .feed-row .setting-identifier").each(function(i) {
				if (objGuest[i] !== undefined) {
					$(this).text(objGuest[i][1] + ", " + objGuest[i][2] + ", " + objGuest[i++][3]);
				}
			});
		});

		/* fb photo*/
		/*
		$(document).bind('fbInitPicLoaded',function(){
				$("#FacebookPhoto").prop("src", window.picurl);
			});
		*/

		</script>

		<script>
			$(document).bind('fbInitPicLoaded',function(){
				$("#FacebookPhoto").prop("src", window.picurl);
			});
			//This sets up the invite to meal button.
		
		    $(document).bind('fbInit',function(){
				console.log('fbInit complete; FB Object is Available');

				$(".invitebutton").each(function(i) {
			    	if (objHost[i] !== undefined) { 
			        	$(this).prop("href", "../invite/" + objHost[i++][0]);
			        }
			    });
				
				$(".removebutton").each(function(i) {
			    	if (objHost[i] !== undefined) { 
			        	$(this).prop("href", "../remove/" + objHost[i++][0] + '/' + window.uid);
			        }
				});
			});
		</script>
			
			<footer>
				<div class="container">
					<div class="row">
						<div class="col" style="text-align:center;color:white;">&copy; 2014 TigerGrowl</div>
						<div class="col-md-4">
							<ul class="nav nav-pills">

							</ul>
						</div>

					</div>
				</div>
			</div>
		</footer>
		<div id="fb-root"></div>

		<!-- Facebook verification -->
		<script type="text/javascript">
			window.fbAsyncInit = function() {
				FB.init({
					appId      : '1423477091234772',
							status     : true, // check login status
							cookie     : true, // enable cookies to allow the server to access the session
							xfbml      : true  // parse XFBML
						});
				FB.getLoginStatus(function(response) {
					if (response.status === 'connected') {
						uid = response.authResponse.userID;
						$(document).trigger('fbInit');

						FB.api('me?fields=picture.height(80)', function(response) {
							if (!response || response.error) {
								console.log('Error occured');
							} else {
								picurl = response["picture"]["data"]["url"];
								console.log(picurl)
								$(document).trigger('fbInitPicLoaded');
							}
						});
					}
					else {
					} 
				});
			}
		</script>

		<!-- Error Handling: Success -->
		<script type="text/javascript">			

			var message = "{{ message }}";
			if (message == "success") {
				alert("You have successfully joined the meal!");
			}		
		</script>
	</body>
	</html>